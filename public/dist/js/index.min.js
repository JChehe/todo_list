var LIB=LIB||{};!function(t,e){function i(){this.ENTER_KEY=13,this.ESCAPE_KEY=27,this.$todoList=qs(".todo-list"),this.$todoItemCounter=qs(".todo-count"),this.$clearCompleted=qs(".clear-completed"),this.$main=qs(".main"),this.$footer=qs(".footer"),this.$toggleAll=qs(".toggle-all"),this.$newTodo=qs(".new-todo"),this.$filters=qs(".filters"),this.data=[]}function a(t){var e={};return"completed"===t.status&&(e={className:"completed",checked:"checked"}),'<li data-id="'+t.id+'" class="'+(e.className||"")+'"><div class="view"><input class="toggle" type="checkbox" '+(e.checked||"")+"><label>"+t.value+'</label><button class="destroy"></button></div></li>'}function o(t){var e=document.createElement("div"),i=a(t);return e.innerHTML=i,e.children[0]}function d(){return t.location.hash.replace(/^#\//,"")}var l=e.util.Dom,s=e.util.Event,n=e.util.localStorage;i.prototype.init=function(){var t=n.get("data")||[];this.data=t,this._bind(),this._filterItem(d()),this._checkIsAllCompleted()},i.prototype._addItemHandler=function(t){t.status="active";var e=o(t);this.$newTodo.value="",this._method.add.call(this,t),"completed"!==d()&&this.$todoList.appendChild(e),this._updateLeftItemCount()},i.prototype._removeItemHandler=function(t){var e=qs("[data-id='"+t+"']");e&&(this.$todoList.removeChild(e),this._method.delById.call(this,t),this._updateLeftItemCount())},i.prototype._editStatus=function(t){var e=qs("[data-id='"+t+"']");if(e){var i=qs("label",e),a=document.createElement("input");a.value=i.innerHTML,a.className="edit",e.appendChild(a),e.classList.add("editing"),a.focus()}},i.prototype._editDoneHandler=function(t){var e=qs("[data-id='"+t.id+"']");if(e){var i=qs("input.edit",e),a=qs("label",e);a.innerHTML=t.value,e.classList.remove("editing"),l.remove(i)}},i.prototype._updateLeftItemCount=function(){var t=0,e=qs("strong",this.$todoItemCounter);e&&(this.data.forEach(function(e){"active"===e.status&&t++}),e.innerHTML=t,t<this.data.length?this._toggleClearCompleted(!0):this._toggleClearCompleted(!1),this._checkItemLength())},i.prototype._setItemCompleted=function(t){var e=qs("[data-id='"+t+"']",this.$todoList),i=qs(".toggle",e),a=d();e&&(i.checked=!0,e.classList.add("completed"),this._method.updateById.call(this,t,"status","completed"),this._updateLeftItemCount(),"active"===a&&(e.style.display="none"))},i.prototype._setItemActive=function(t){var e=qs("[data-id='"+t+"']",this.$todoList),i=qs(".toggle",e),a=d();e&&(i.checked=!1,e.classList.remove("completed"),this._method.updateById.call(this,t,"status","active"),this._updateLeftItemCount(),"completed"===a&&(e.style.display="none"))},i.prototype._renderMore=function(t){for(var e="",i=0,o=t.length;o>i;i++)e+=a(t[i]);this.$todoList.innerHTML=e,this._updateLeftItemCount()},i.prototype._filterItem=function(t){var e,i=qsa("li a",this.$filters);t=t?t:d(),[].slice.call(i).forEach(function(t){t.classList.remove("selected")}),"active"===t?(e=this._filterData("active"),i[1].classList.add("selected")):"completed"===t?(e=this._filterData("completed"),i[2].classList.add("selected")):(e=this.data,i[0].classList.add("selected")),this._renderMore(e)},i.prototype._filterData=function(t){var e,i=this.data;return e=i.filter(function(e){return e.status===t?!0:void 0})},i.prototype._toggleClearCompleted=function(t){void 0===t&&(t=this._method.hasCompleted.call(this));var e=this.$clearCompleted.style;t?e.display="block":e.display="none"},i.prototype._checkIsAllCompleted=function(){var t=this._method.isAllCompleted.call(this);t&&(this.$toggleAll.checked=!0)},i.prototype._checkItemLength=function(){0===this.data.length?this.$toggleAll.style.display="none":this.$toggleAll.style.display="block"},i.prototype._method=function(){function t(t,e){for(var i=0,a=e.data.length;a>i;i++)if(e.data[i].id==t)return i}function e(e){var i=t(e,this);this.data.splice(i,1),n.set("data",this.data)}function i(e,i,a){var o=t(e,this),d=this.data[o];d[i]=a,n.set("data",this.data)}function a(t){this.data.push(t),n.set("data",this.data)}function o(){this.data.forEach(function(t){t.status="completed"}),n.set("data",this.data)}function d(){this.data.forEach(function(t){t.status="active"}),n.set("data",this.data)}function l(){this.data.some(function(t){return"completed"===t.status})}function s(){return 0===this.data.length?!1:this.data.every(function(t){return"completed"===t.status})}function c(){return 0===this.data.length?!1:this.data.every(function(t){return"active"===t.status})}return{delById:e,updateById:i,add:a,setAllActive:d,setAllCompleted:o,hasCompleted:l,isAllCompleted:s,isAllActive:c}}(),i.prototype._bind=function(){var e=this;s.addListener(e.$newTodo,"keypress",function(t){var i=this.value.trim(),a=t.keyCode;""!==i&&a===e.ENTER_KEY&&e._addItemHandler({id:Date.now(),value:i})}),s.addListener(e.$newTodo,"blur",function(t){var i=this.value.trim();""!==i&&e._addItemHandler({id:Date.now(),value:i})}),s.delegate(e.$todoList,"li .toggle","click",function(t){var i=l.closest(this,"li"),a=i.getAttribute("data-id");this.checked?(e._setItemCompleted(a),e._checkIsAllCompleted()):(e._setItemActive(a),e.$toggleAll.checked=!1)}),s.delegate(e.$todoList,"li .destroy","click",function(t){var i=l.closest(this,"li"),a=i.getAttribute("data-id");e._removeItemHandler(a)}),s.delegate(e.$todoList,"li label","dblclick",function(t){var i=l.closest(this,"li"),a=i.getAttribute("data-id");e._editStatus(a)}),s.delegate(e.$todoList,"input.edit","keydown",function(t){var i=l.closest(this,"li"),a=i.getAttribute("data-id"),o=this.value.trim(),d=t.keyCode;return""===o?void e._removeItemHandler(a):void(d!==e.ENTER_KEY&&d!==e.ESCAPE_KEY||e._editDoneHandler({id:a,value:o}))}),s.delegate(e.$todoList,"input.edit","blur",function(t){var i=l.closest(this,"li"),a=i.getAttribute("data-id"),o=this.value.trim();t.keyCode;return""===o?void e._removeItemHandler(a):void e._editDoneHandler({id:a,value:o})},!0),s.addListener(t,"hashchange",function(t){var i=d();e._filterItem(i)}),s.addListener(e.$toggleAll,"click",function(t){var i=d();this.checked?"active"===i?(e._method.setAllCompleted.call(e),e._renderMore([])):"completed"===i?(e._method.setAllCompleted.call(e),e._renderMore(e.data)):[].slice.call(e.$todoList.children).forEach(function(t){e._setItemCompleted(t.getAttribute("data-id"))}):"active"===i?(e._method.setAllActive.call(e),e._renderMore(e.data)):"completed"===i?(e._method.setAllActive.call(e),e._renderMore([])):[].slice.call(e.$todoList.children).forEach(function(t){e._setItemActive(t.getAttribute("data-id"))}),e._checkIsAllCompleted()}),s.addListener(e.$clearCompleted,"click",function(t){for(var i=0;i<e.data.length;i++){var a=e.data[i];"completed"===a.status&&(e._removeItemHandler(a.id),i--)}})},t.App=i}(window,LIB);