var LIB=LIB||{};!function(t){function e(){this.ENTER_KEY=13,this.ESCAPE_KEY=27,this.$todoList=qs(".todo-list"),this.$todoItemCounter=qs(".todo-count"),this.$clearCompleted=qs(".clear-completed"),this.$main=qs(".main"),this.$footer=qs(".footer"),this.$toggleAll=qs(".toggle-all"),this.$newTodo=qs(".new-todo"),this.$filters=qs(".filters"),this.data=[{id:1,value:"123",status:"active"},{id:2,value:"456",status:"completed"},{id:3,value:"789",status:"completed"},{id:4,value:"101",status:"completed"},{id:5,value:"102",status:"completed"},{id:6,value:"103",status:"completed"}]}function i(t){var e={};return"completed"===t.status&&(e={className:"completed",checked:"checked"}),'<li data-id="'+t.id+'" class="'+(e.className||"")+'"><div class="view"><input class="toggle" type="checkbox" '+(e.checked||"")+"><label>"+t.value+'</label><button class="destroy"></button></div></li>'}function o(t){var e=document.createElement("div");console.log(t);var o=i(t);return e.innerHTML=o,e.children[0]}var a=t.util.Dom,d=t.util.Event;e.prototype.init=function(){this._bind(),this._filterItem(window.location.hash)},e.prototype._addItemHandler=function(t){var e=o({id:t.id,value:t.val});this.$newTodo.value="",this._method.add.call(this,e),this.$todoList.appendChild(e),this._updateLeftItemCount()},e.prototype._removeItemHandler=function(t){var e=qs("[data-id='"+t+"']");e&&(this.$todoList.removeChild(e),this._method.delById.call(this,t),this._updateLeftItemCount())},e.prototype._editStatus=function(t){var e=qs("[data-id='"+t+"']");if(e){var i=qs("label",e),o=document.createElement("input");o.value=i.innerHTML,o.className="edit",e.appendChild(o),e.classList.add("editing"),o.focus()}},e.prototype._editDoneHandler=function(t){var e=qs("[data-id='"+t.id+"']");if(e){var i=qs("input.edit",e),o=qs("label",e);o.innerHTML=t.value,e.classList.remove("editing"),a.remove(i)}},e.prototype._updateLeftItemCount=function(){var t=0,e=qs("strong",this.$todoItemCounter);e&&(this.data.forEach(function(e){"active"===e.status&&t++}),e.innerHTML=t,t<this.data.length?this._toggleClearCompleted(!0):this._toggleClearCompleted(!1))},e.prototype._setItemCompleted=function(t){var e=qs("[data-id='"+t+"']",this.$todoList),i=qs(".toggle",e),o=window.location.hash.replace(/^#\//,"");e&&(i.checked=!0,e.classList.add("completed"),this._method.updateById.call(this,t,"status","completed"),this._updateLeftItemCount(),"active"===o&&(e.style.display="none"))},e.prototype._setItemActive=function(t){var e=qs("[data-id='"+t+"']",this.$todoList),i=qs(".toggle",e),o=window.location.hash.replace(/^#\//,"");e&&(i.checked=!1,e.classList.remove("completed"),this._method.updateById.call(this,t,"status","active"),this._updateLeftItemCount(),"completed"===o&&(e.style.display="none"))},e.prototype._renderMore=function(t){for(var e="",o=0,a=t.length;a>o;o++)e+=i(t[o]);this.$todoList.innerHTML=e,this._updateLeftItemCount()},e.prototype._filterItem=function(t){var e,i=qsa("li a",this.$filters);t=t?t.replace(/^#\//,""):"",[].slice.call(i).forEach(function(t){t.classList.remove("selected")}),"active"===t?(e=this._filterData("active"),i[1].classList.add("selected")):"completed"===t?(e=this._filterData("completed"),i[2].classList.add("selected")):(e=this.data,i[0].classList.add("selected")),this._renderMore(e)},e.prototype._filterData=function(t){var e,i=this.data;return e=i.filter(function(e){return e.status===t?!0:void 0})},e.prototype._toggleClearCompleted=function(t){void 0==t&&(t=this._method.hasCompleted.call(this));var e=this.$clearCompleted.style;t?e.display="block":e.display="none"},e.prototype._method=function(){function t(t,e){for(var i=0,o=e.data.length;o>i;i++)if(e.data[i].id==t)return i}function e(e){console.log(this);var i=t(e,this);this.data.splice(i,1)}function i(e,i,o){console.log(this);var a=t(e,this),d=this.data[a];console.log(d),d[i]=o}function o(t){console.log(this),this.data.push(t)}function a(){this.data.forEach(function(t){t.status="completed"})}function d(){this.data.forEach(function(t){t.status="active"})}function l(){this.data.some(function(t){return"completed"===t.status})}return{delById:e,updateById:i,add:o,setAllActive:d,setAllCompleted:a,hasCompleted:l}}(),e.prototype._bind=function(){var t=this;d.addListener(t.$newTodo,"keypress",function(e){var i=this.value.trim(),o=e.keyCode;""!==i&&o===t.ENTER_KEY&&t._addItemHandler({id:Date.now(),val:i})}),d.addListener(t.$newTodo,"blur",function(e){var i=this.value.trim();""!==i&&t._addItemHandler({id:Date.now(),val:i})}),d.delegate(t.$todoList,"li .toggle","click",function(e){var i=a.closest(this,"li"),o=i.getAttribute("data-id");this.checked?t._setItemCompleted(o):t._setItemActive(o)}),d.delegate(t.$todoList,"li .destroy","click",function(e){var i=a.closest(this,"li"),o=i.getAttribute("data-id");t._removeItemHandler(o),console.log(t.$todoList.children)}),d.delegate(t.$todoList,"li label","dblclick",function(e){var i=a.closest(this,"li"),o=i.getAttribute("data-id");t._editStatus(o)}),d.delegate(t.$todoList,"input.edit","keydown",function(e){var i=a.closest(this,"li"),o=i.getAttribute("data-id"),d=this.value.trim(),l=e.keyCode;return""===d?void t._removeItemHandler(o):void(l!==t.ENTER_KEY&&l!==t.ESCAPE_KEY||t._editDoneHandler({id:o,value:d}))}),d.delegate(t.$todoList,"input.edit","blur",function(e){var i=a.closest(this,"li"),o=i.getAttribute("data-id"),d=this.value.trim();e.keyCode;return""===d?void t._removeItemHandler(o):void t._editDoneHandler({id:o,value:d})},!0),d.addListener(window,"hashchange",function(e){var i=window.location.hash;t._filterItem(i)}),d.addListener(t.$toggleAll,"click",function(e){var i=window.location.hash.replace(/^#\//,"");this.checked?"active"===i?(t._method.setAllCompleted.call(t),t._renderMore([])):"completed"===i?(t._method.setAllCompleted.call(t),t._renderMore(t.data)):[].slice.call(t.$todoList.children).forEach(function(e){t._setItemCompleted(e.getAttribute("data-id"))}):"active"===i?(t._method.setAllActive.call(t),t._renderMore(t.data)):"completed"===i?(t._method.setAllActive.call(t),t._renderMore([])):[].slice.call(t.$todoList.children).forEach(function(e){t._setItemActive(e.getAttribute("data-id"))})}),d.addListener(t.$clearCompleted,"click",function(e){for(var i=0;i<t.data.length;i++){var o=t.data[i];"completed"===o.status&&(t._removeItemHandler(o.id),i--)}})},(new e).init()}(LIB);